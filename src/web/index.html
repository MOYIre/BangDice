<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BangDice - Morfonica Style</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    :root {
      --primary-color: #8765B3;
      --secondary-color: #FF7EB3;
      --accent-color: #FFC84D;
      --bg-color: #f8f9ff;
      --card-bg: rgba(255, 255, 255, 0.9);
      --text-color: #333;
      --border-radius: 12px;
      --box-shadow: 0 4px 20px rgba(135, 101, 179, 0.15);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f0f4ff 0%, #e6f7ff 100%);
      color: var(--text-color);
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
      background-attachment: fixed;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* BangDream é£æ ¼å¤´éƒ¨ */
    .header {
      text-align: center;
      padding: 30px 0;
      margin-bottom: 30px;
      position: relative;
    }

    .header h1 {
      font-size: 2.5rem;
      color: var(--primary-color);
      margin-bottom: 10px;
      font-weight: 700;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      letter-spacing: 1px;
    }

    .header-subtitle {
      color: var(--secondary-color);
      font-size: 1.2rem;
      opacity: 0.8;
    }

    /* BangDream é£æ ¼å¡ç‰‡ */
    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: var(--box-shadow);
      border: 1px solid rgba(135, 101, 179, 0.1);
      backdrop-filter: blur(10px);
    }

    .card-title {
      font-size: 1.4rem;
      color: var(--primary-color);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--secondary-color);
      display: flex;
      align-items: center;
    }

    .card-title i {
      margin-right: 10px;
      font-size: 1.6rem;
    }

    /* å“åº”å¼ç½‘æ ¼å¸ƒå±€ */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    /* BangDream é£æ ¼æŒ‰é’® */
    .btn {
      display: inline-block;
      padding: 12px 24px;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: white;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      text-align: center;
      transition: all 0.3s ease;
      text-decoration: none;
      box-shadow: 0 4px 15px rgba(135, 101, 179, 0.3);
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 7px 20px rgba(135, 101, 179, 0.4);
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary-color);
      color: var(--primary-color);
      box-shadow: none;
    }

    .btn-outline:hover {
      background: var(--primary-color);
      color: white;
    }

    /* BangDream é£æ ¼è¡¨å• */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--primary-color);
    }

    .form-control {
      width: 100%;
      padding: 14px;
      border: 2px solid rgba(135, 101, 179, 0.2);
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: border-color 0.3s;
      background: rgba(255, 255, 255, 0.7);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(135, 101, 179, 0.2);
    }

    /* æ’ä»¶å¡ç‰‡ */
    .plugin-card {
      border: 1px solid rgba(135, 101, 179, 0.2);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 15px;
      transition: all 0.3s ease;
      background: var(--card-bg);
    }

    .plugin-card:hover {
      box-shadow: 0 6px 15px rgba(135, 101, 179, 0.2);
      border-color: var(--secondary-color);
    }

    .plugin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .plugin-name {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--primary-color);
    }

    .plugin-status {
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .status-active {
      background: rgba(72, 187, 120, 0.2);
      color: #2f7d32;
    }

    .status-inactive {
      background: rgba(245, 101, 101, 0.2);
      color: #b42318;
    }

    .plugin-description {
      color: #666;
      margin: 10px 0;
    }

    .plugin-actions {
      text-align: right;
      margin-top: 15px;
    }

    /* æ—¥å¿—åŒºåŸŸ */
    .logs-container {
      max-height: 400px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.03);
      border-radius: var(--border-radius);
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      border: 1px solid rgba(135, 101, 179, 0.1);
    }

    .log-item {
      padding: 8px 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .log-item:last-child {
      border-bottom: none;
    }

    .log-timestamp {
      color: #888;
      font-size: 0.8rem;
      margin-right: 10px;
    }

    .log-info {
      color: var(--primary-color);
    }

    .log-error {
      color: #e53e3e;
    }

    .log-success {
      color: #38a169;
    }

    /* è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ */
    .status-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }

    .status-dot.connected {
      background-color: #48BB78;
      box-shadow: 0 0 10px #48BB78;
    }

    .status-dot.disconnected {
      background-color: #E53E3E;
    }

    /* é€‰é¡¹å¡å¯¼èˆª */
    .tabs {
      display: flex;
      flex-wrap: nowrap;
      gap: 5px;
      margin-bottom: 10px;
      margin-top: -15px;
      overflow-x: auto;
      padding-bottom: 5px;
    }

    .tab-button {
      padding: 12px 24px;
      background: rgba(135, 101, 179, 0.1);
      border: none;
      border-radius: 30px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      color: var(--primary-color);
      transition: all 0.3s ease;
    }

    .tab-button.active {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: white;
    }

    .tab-content {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    /* ç§»åŠ¨ç«¯é€‚é… */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .header h1 {
        font-size: 2rem;
      }

      .grid {
        grid-template-columns: 1fr;
      }

      .tabs {
        overflow-x: auto;
        justify-content: flex-start;
      }

      .card {
        padding: 20px;
      }

      .plugin-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .plugin-actions {
        width: 100%;
        text-align: left;
      }

      .btn {
        width: 100%;
        margin-bottom: 10px;
      }
    }

    /* åŠ¨ç”»æ•ˆæœ */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-enter-active, .fade-leave-active {
      transition: opacity 0.3s;
    }

    .fade-enter-from, .fade-leave-to {
      opacity: 0;
    }

    /* BangDream é£æ ¼è£…é¥° */
    .bangdream-decoration {
      position: fixed;
      opacity: 0.05;
      z-index: -1;
      font-size: 10rem;
      pointer-events: none;
    }

    .decoration-1 {
      top: 10%;
      left: 5%;
      transform: rotate(-15deg);
    }

    .decoration-2 {
      bottom: 10%;
      right: 5%;
      transform: rotate(15deg);
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- BangDream é£æ ¼è£…é¥°å…ƒç´  -->
    <div class="bangdream-decoration decoration-1">ğŸ²</div>
    <div class="bangdream-decoration decoration-2">ğŸµ</div>

    <div class="container">
      <!-- å¤´éƒ¨ -->
      <div class="header">
        <h1>âœ¨ BangDice âœ¨</h1>
      </div>

      <!-- é€‰é¡¹å¡å¯¼èˆª -->
      <div class="tabs">
        <button class="tab-button" 
                :class="{ active: activeTab === 'dashboard' }" 
                @click="activeTab = 'dashboard'">æ§åˆ¶å°</button>
        <button class="tab-button" 
                :class="{ active: activeTab === 'plugins' }" 
                @click="activeTab = 'plugins'">æ’ä»¶ç®¡ç†</button>
        <button class="tab-button" 
                :class="{ active: activeTab === 'config' }" 
                @click="activeTab = 'config'">é…ç½®</button>
        <button class="tab-button" 
                :class="{ active: activeTab === 'logs' }" 
                @click="activeTab = 'logs'">æ—¥å¿—</button>
      </div>

      <!-- æ§åˆ¶å°é€‰é¡¹å¡ -->
      <div v-show="activeTab === 'dashboard'" class="tab-content">
        <div class="grid">
          <div class="card">
            <h3 class="card-title">è¿æ¥çŠ¶æ€</h3>
            <div class="status-indicator">
              <span class="status-dot" :class="connectionStatus ? 'connected' : 'disconnected'"></span>
              <span>{{ connectionStatus ? 'å·²è¿æ¥' : 'æœªè¿æ¥' }}</span>
            </div>
            <p style="margin-top: 15px;">WebSocket: {{ config.wsUrl }}</p>
          </div>

          <div class="card">
            <h3 class="card-title">æœåŠ¡å™¨ä¿¡æ¯</h3>
            <p>æ´»è·ƒç¾¤ç»„: {{ stats.activeGroups }}</p>
            <p>æ´»è·ƒæ’ä»¶: {{ stats.activePlugins }}</p>
            <p>æ¶ˆæ¯è®¡æ•°: {{ stats.messageCount }}</p>
          </div>
        </div>

        
      </div>

      <!-- æ’ä»¶ç®¡ç†é€‰é¡¹å¡ -->
      <div v-show="activeTab === 'plugins'" class="tab-content">
        <div class="card">
          <h3 class="card-title">æ’ä»¶ç®¡ç†</h3>
          <div v-for="plugin in plugins" :key="plugin.name" class="plugin-card">
            <div class="plugin-header">
              <div class="plugin-name">{{ plugin.name }}</div>
              <div class="plugin-status" :class="plugin.enabled ? 'status-active' : 'status-inactive'">
                {{ plugin.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨' }}
              </div>
            </div>
            <div class="plugin-author">ä½œè€…: {{ plugin.author }}</div>
            <div class="plugin-description" :title="plugin.description" style="cursor: pointer; max-height: 4rem; overflow: hidden;" @click="toggleDescription($event, plugin.description)">
              {{ plugin.description && plugin.description.length > 80 ? plugin.description.substring(0, 80) + '...' : plugin.description }}
            </div>
            <div class="plugin-actions">
              <button v-if="plugin.enabled" @click="togglePlugin(plugin.name, false)" class="btn btn-outline" style="background: #ffe0e0; color: #c53030; border-color: #c53030;">
                ç¦ç”¨
              </button>
              <button v-else @click="togglePlugin(plugin.name, true)" class="btn" style="background: #e0ffe0; color: #2f7d32;">
                å¯ç”¨
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- é…ç½®é€‰é¡¹å¡ -->
      <div v-show="activeTab === 'config'" class="tab-content">
        <div class="card">
          <h3 class="card-title">æœåŠ¡å™¨é…ç½®</h3>
          <div class="form-group">
            <label for="wsUrl">WebSocket åœ°å€</label>
            <input type="text" id="wsUrl" v-model="config.wsUrl" class="form-control" placeholder="ws://127.0.0.1:3001">
          </div>
          <div class="form-group">
            <label for="accessToken">Access Token (å¯é€‰)</label>
            <input type="password" id="accessToken" v-model="config.accessToken" class="form-control">
          </div>
                      <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button @click="saveConfig" class="btn">ä¿å­˜é…ç½®</button>
            <button @click="applyOnebotConfig" class="btn">åº”ç”¨OneBoté…ç½®</button>
          </div>
        </div>
      </div>

      <!-- æ—¥å¿—é€‰é¡¹å¡ -->
      <div v-show="activeTab === 'logs'" class="tab-content">
        <div class="card">
          <h3 class="card-title">ç³»ç»Ÿæ—¥å¿—</h3>
          <div class="logs-container">
            <div v-for="log in logs" :key="log.id" class="log-item" :class="'log-' + log.type">
              <span class="log-timestamp">[{{ log.timestamp }}]</span>
              {{ log.message }}
            </div>
          </div>
          <div style="margin-top: 15px;">
            <button @click="clearLogs" class="btn btn-outline">æ¸…ç©ºæ—¥å¿—</button>
          </div>
        </div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const { createApp, ref, onMounted } = Vue;

      createApp({
        setup() {
          // å“åº”å¼æ•°æ®
          const activeTab = ref('dashboard');
          const connectionStatus = ref(false);
          const config = ref({
            wsUrl: 'ws://127.0.0.1:3001',
            accessToken: ''
          });
          const stats = ref({
            activeGroups: 0,
            activePlugins: 0,
            messageCount: 0
          });
          const plugins = ref([]);
          // æœ¬åœ°æ’ä»¶çŠ¶æ€è¦†ç›–ï¼Œç”¨äºåœ¨åç«¯æœªæ›´æ–°æ—¶ä¿æŒç”¨æˆ·æ“ä½œçš„çŠ¶æ€
          const localPluginStatus = ref(new Map());
          const logs = ref([]);

          // Socket.IO è¿æ¥
          let socket = null;

          // æ·»åŠ æ—¥å¿—
          const addLog = (message, type = 'info') => {
            const timestamp = new Date().toLocaleString();
            logs.value.unshift({ id: Date.now(), timestamp, message, type });
            // åªä¿ç•™æœ€è¿‘100æ¡æ—¥å¿—
            if (logs.value.length > 100) {
              logs.value = logs.value.slice(0, 100);
            }
          };

          // è¿æ¥æœåŠ¡å™¨
          const connectToServer = () => {
            // ä½¿ç”¨Socket.IOè¿æ¥åˆ°BangDiceåç«¯
            // è¿™é‡Œåº”è¯¥è¿æ¥åˆ°å½“å‰é¡µé¢çš„æœåŠ¡å™¨ï¼Œè€Œä¸æ˜¯ç”¨æˆ·è¾“å…¥çš„wsUrl
            socket = io({
              auth: {
                token: config.value.accessToken
              },
              transports: ['websocket']
            });

            socket.on('connect', () => {
              connectionStatus.value = true;
              addLog('å·²è¿æ¥åˆ° BangDice WebUI æœåŠ¡å™¨', 'success');
              // è¯·æ±‚åˆå§‹æ•°æ®
              socket.emit('get_config');
              socket.emit('get_plugins');
              // å®šæœŸè·å–çŠ¶æ€æ›´æ–°
              setInterval(() => {
                socket.emit('get_config'); // æ›´æ–°é…ç½®
              }, 5000); // æ¯5ç§’æ›´æ–°ä¸€æ¬¡é…ç½®ä¿¡æ¯
            });

            socket.on('disconnect', () => {
              connectionStatus.value = false;
              addLog('ä¸ BangDice æœåŠ¡å™¨æ–­å¼€è¿æ¥', 'error');
            });

            socket.on('connect_error', (error) => {
              connectionStatus.value = false;
              addLog('è¿æ¥ BangDice WebUI æœåŠ¡å™¨å¤±è´¥: ' + error.message, 'error');
            });

            // ç›‘å¬çŠ¶æ€æ›´æ–°
            socket.on('status_update', (data) => {
              // æ›´æ–°è¿æ¥çŠ¶æ€
              if (data.connected !== undefined) {
                connectionStatus.value = data.connected === true;
              }
              
              // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ - ä½¿ç”¨åˆå¹¶æ–¹å¼ï¼Œè€Œä¸æ˜¯æ›¿æ¢æ•´ä¸ªå¯¹è±¡
              if (data.activeGroups !== undefined) {
                stats.value.activeGroups = data.activeGroups;
              }
              if (data.activePlugins !== undefined) {
                stats.value.activePlugins = data.activePlugins;
              }
              if (data.messageCount !== undefined) {
                stats.value.messageCount = data.messageCount;
              }
              
              // ä¿å­˜æœ€åçš„çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
              const lastStats = {
                activeGroups: stats.value.activeGroups,
                activePlugins: stats.value.activePlugins,
                messageCount: stats.value.messageCount
              };
              localStorage.setItem('bangdice_last_stats', JSON.stringify(lastStats));
            });
            
            // ç›‘å¬OneBotçŠ¶æ€æ›´æ–°
            socket.on('onebot_status_update', (data) => {
              if (data.connected !== undefined) {
                connectionStatus.value = data.connected === true;
              }
            });
            
            // ç›‘å¬æ’ä»¶åˆ—è¡¨
            socket.on('plugins_list', (pluginList) => {
              console.log('Received plugins:', pluginList); // è°ƒè¯•æ—¥å¿—
              addLog(`æ”¶åˆ°æ’ä»¶åˆ—è¡¨: ${pluginList.length} ä¸ªæ’ä»¶`, 'info');
              
              if (!pluginList || pluginList.length === 0) {
                // å¦‚æœæ²¡æœ‰æ’ä»¶ï¼Œæ·»åŠ ä¸€ä¸ªæç¤º
                plugins.value = [{
                  name: 'æ— æ’ä»¶',
                  command: '',
                  description: 'æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ’ä»¶',
                  author: 'ç³»ç»Ÿ',
                  enabled: true
                }];
              } else {
                plugins.value = pluginList.map(p => {
                  // æ£€æŸ¥æ˜¯å¦æœ‰æœ¬åœ°çŠ¶æ€è¦†ç›–
                  const localStatus = localPluginStatus.value.get(p.name);
                  const effectiveEnabled = localStatus !== undefined ? localStatus : (p.enabled !== undefined ? p.enabled : true);
                  
                  return {
                    name: p.name,
                    command: p.command,
                    description: p.description || 'æš‚æ— æè¿°',
                    author: p.author || 'æœªçŸ¥',
                    enabled: effectiveEnabled
                  };
                });
              }
            });
            
            // ç›‘å¬é…ç½®æ›´æ–°
            socket.on('config_update', (data) => {
              config.value.wsUrl = data.wsUrl || config.value.wsUrl;
              config.value.accessToken = data.accessToken || config.value.accessToken;
            });
          };

          // æ–­å¼€è¿æ¥
          const disconnectServer = () => {
            if (socket) {
              socket.disconnect();
              socket = null;
              connectionStatus.value = false;
            }
          };

          // ä¿å­˜é…ç½®
          const saveConfig = () => {
            if (socket) {
              socket.emit('update_config', {
                wsUrl: config.value.wsUrl,
                accessToken: config.value.accessToken
              });
              // åŒæ—¶ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
              localStorage.setItem('bangdice_config', JSON.stringify(config.value));
              addLog('é…ç½®å·²å‘é€åˆ°æœåŠ¡å™¨å¹¶ä¿å­˜åˆ°æœ¬åœ°', 'success');
            } else {
              // å³ä½¿æ²¡æœ‰è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œä¹Ÿä¿å­˜åˆ°æœ¬åœ°
              localStorage.setItem('bangdice_config', JSON.stringify(config.value));
              addLog('é…ç½®å·²ä¿å­˜åˆ°æœ¬åœ°', 'success');
            }
          };
          
          // åº”ç”¨OneBoté…ç½®
          const applyOnebotConfig = () => {
            if (socket) {
              socket.emit('connect_onebot', {
                wsUrl: config.value.wsUrl,
                accessToken: config.value.accessToken
              });
              addLog('OneBoté…ç½®å·²åº”ç”¨', 'success');
            } else {
              addLog('è¯·å…ˆè¿æ¥åˆ°æœåŠ¡å™¨', 'error');
            }
          };

          // åˆ‡æ¢æ’ä»¶çŠ¶æ€
          const togglePlugin = (pluginName, enable) => {
            if (socket) {
              // åŒæ—¶å‘é€ socket äº‹ä»¶å’Œ API è¯·æ±‚ä»¥ç¡®ä¿çŠ¶æ€æ›´æ–°
              socket.emit('plugin_action', {
                plugin: pluginName,
                action: enable ? 'enable' : 'disable'
              });
              
              // é€šè¿‡ fetch API å‘é€æ’ä»¶çŠ¶æ€å˜æ›´è¯·æ±‚
              fetch('/api/plugins', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  plugin: pluginName,
                  action: enable ? 'enable' : 'disable'
                })
              })
              .then(response => response.json())
              .then(data => {
                if (data.success) {
                  addLog(`${pluginName} çŠ¶æ€å·²æ›´æ–°: ${enable ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'success');
                } else {
                  addLog(`æ›´æ–° ${pluginName} çŠ¶æ€å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                }
              })
              .catch(error => {
                addLog(`æ›´æ–°æ’ä»¶çŠ¶æ€æ—¶å‘ç”Ÿé”™è¯¯: ${error.message}`, 'error');
              });
              
              addLog(`${pluginName} çŠ¶æ€å˜æ›´è¯·æ±‚å·²å‘é€`, 'info');
              
              // è®°å½•æœ¬åœ°çŠ¶æ€å˜æ›´
              localPluginStatus.value.set(pluginName, enable);
              
              // ç«‹å³æ›´æ–°æœ¬åœ°æ’ä»¶çŠ¶æ€ä»¥æä¾›å³æ—¶åé¦ˆ
              const plugin = plugins.value.find(p => p.name === pluginName);
              if (plugin) {
                plugin.enabled = enable;
              }
              
              // è¯·æ±‚æ›´æ–°æ’ä»¶åˆ—è¡¨ä»¥åŒæ­¥åç«¯çŠ¶æ€
              setTimeout(() => {
                socket.emit('get_plugins');
              }, 1000); // ç¨ç­‰ç‰‡åˆ»è®©åç«¯å¤„ç†
            } else {
              addLog('è¯·å…ˆè¿æ¥åˆ°æœåŠ¡å™¨', 'error');
            }
          };

          

          // å±•å¼€/æŠ˜å æè¿°
          const toggleDescription = (event, fullDescription) => {
            // ä¸ºäº†ç®€å•èµ·è§ï¼Œè¿™é‡Œå¯ä»¥å®ç°ç‚¹å‡»å±•å¼€åŠŸèƒ½
            // å½“å‰å®ç°ä¸ºç‚¹å‡»æ—¶åœ¨æ§åˆ¶å°è¾“å‡ºå®Œæ•´æè¿°
            console.log('å®Œæ•´æè¿°:', fullDescription);
            // å¯ä»¥åœ¨è¿™é‡Œå®ç°å±•å¼€/æŠ˜å é€»è¾‘
          };
          
          // æ¸…ç©ºæ—¥å¿—
          const clearLogs = () => {
            logs.value = [];
            addLog('æ—¥å¿—å·²æ¸…ç©º', 'info');
          };

          // é¡µé¢åŠ è½½æ—¶æ¢å¤é…ç½®å¹¶è‡ªåŠ¨è¿æ¥
          onMounted(() => {
            const savedConfig = localStorage.getItem('bangdice_config');
            if (savedConfig) {
              try {
                config.value = JSON.parse(savedConfig);
              } catch (e) {
                console.error('æ¢å¤é…ç½®å¤±è´¥:', e);
                addLog('é…ç½®æ¢å¤å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼', 'error');
              }
            }
            
            // æ¢å¤æœ€åçš„ç»Ÿè®¡ä¿¡æ¯
            const lastStats = localStorage.getItem('bangdice_last_stats');
            if (lastStats) {
              try {
                const parsedStats = JSON.parse(lastStats);
                stats.value.activeGroups = parsedStats.activeGroups || 0;
                stats.value.activePlugins = parsedStats.activePlugins || 0;
                stats.value.messageCount = parsedStats.messageCount || 0;
              } catch (e) {
                console.error('æ¢å¤ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', e);
              }
            }

            // æ·»åŠ åˆå§‹æ—¥å¿—
            addLog('BangDice ç®¡ç†ç•Œé¢å·²å¯åŠ¨', 'success');
            
            // è‡ªåŠ¨è¿æ¥åˆ°æœåŠ¡å™¨
            connectToServer();
          });

          return {
            activeTab,
            connectionStatus,
            config,
            stats,
            plugins,
            logs,
            connectToServer,
            disconnectServer,
            saveConfig,
            applyOnebotConfig,
            togglePlugin,
            toggleDescription,
            clearLogs,
            addLog
          };
        }
      }).mount('#app');
    </script>
  </div>
</body>
</html>